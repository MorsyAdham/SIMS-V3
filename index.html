<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>SIMS - Dashboard</title>
    <link rel="icon" type="image/png" href="assets/img/SIMS_logo_white_bg.png">
    <link rel="stylesheet" href="assets/styles/style.css">
</head>

<body>
    <header class="top">
        <div class="header-left">
            <img src="assets/img/SIMS_logo.png" alt="Dashboard Logo" style="height:50px; width:auto;">
            <div class="header-title">
                <h1>Shipment Inspection System</h1>
                <p class="muted">Monitoring & Analytics Dashboard</p>
            </div>
        </div>

        <div class="header-right">
            <div id="userInfo">
                <div class="user-badge">
                    <span id="userEmail"></span>
                    <span id="userRole" class="role-badge"></span>
                </div>
                <button id="logoutBtn" class="btn btn-logout">Logout</button>
            </div>
        </div>
    </header>

    <main class="container" id="dashboard">
        <!-- Action Bar -->
        <section class="action-bar card">
            <div class="action-left">
                <label class="select-label">
                    Active File
                    <select id="filesSelect" class="styled-select"></select>
                </label>

                <button id="refreshBtn" class="btn btn-icon" title="Refresh Data">
                    <span>üîÑ</span> Refresh
                </button>
            </div>

            <div class="action-right">
                <label class="btn btn-upload" id="uploadLabel">
                    <input id="fileInput" type="file" accept=".xlsx,.xls,.csv" multiple />
                    üìÅ Upload File
                </label>
                <button id="exportBtn" class="btn btn-primary">üìä Export</button>
                <button id="viewAuditBtn" class="btn btn-secondary">üìã Audit Log</button>
            </div>
        </section>

        <!-- Filters Section -->
        <section class="controls card">
            <h3>Filters</h3>
            <div class="filters">
                <label>
                    Shipment
                    <select id="shipmentFilter" class="styled-select">
                        <option value="all">All</option>
                    </select>
                </label>

                <label>
                    Factory
                    <select id="factoryFilter" class="styled-select">
                        <option value="all">All</option>
                    </select>
                </label>

                <label>
                    Container
                    <select id="containerFilter" class="styled-select">
                        <option value="all">All</option>
                    </select>
                </label>

                <label>
                    Status
                    <select id="statusFilter" class="styled-select">
                        <option value="all">All</option>
                        <option value="Finished">Finished</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Not Started">Not Started</option>
                        <option value="Remaining">Remaining</option>
                    </select>
                </label>

                <label class="search-label">
                    Search
                    <input id="searchInput" placeholder="Search boxes, products..." class="search-input" />
                </label>

                <div class="rows-count">
                    <span class="count-label">Showing</span>
                    <span id="rowsCount" class="count-number">0</span>
                    <span class="count-label">rows</span>
                </div>
            </div>
        </section>

        <!-- Summary Cards -->
        <section class="summary-section">
            <div class="summary" id="summaryWrap"></div>

            <div class="pack-stats">
                <div class="card small-stat" id="multipackCard">
                    <div class="stat-header">
                        <span class="stat-icon">üì¶</span>
                        <strong>Multi-pack Boxes</strong>
                    </div>
                    <div id="multipackCount" class="big">0</div>
                    <div class="muted">ItemCount > 1</div>
                </div>

                <div class="card small-stat" id="normalPackCard">
                    <div class="stat-header">
                        <span class="stat-icon">üìã</span>
                        <strong>Normal Boxes</strong>
                    </div>
                    <div id="normalCount" class="big">0</div>
                    <div class="muted">ItemCount = 1</div>
                </div>
            </div>
        </section>

        <!-- Bulk Actions (Admin Only) -->
        <section class="card bulk-actions" id="bulkActionsSection" style="display:none;">
            <h3>Bulk Actions</h3>
            <div class="bulk-controls">
                <label>
                    Apply Remark:
                    <select id="applyRemark" class="styled-select">
                        <option value="">--Select--</option>
                        <option value="Done">Done</option>
                        <option value="In Progress">In Progress</option>
                        <option value="">Clear</option>
                    </select>
                </label>
                <button id="applyAllBtn" class="btn btn-primary">Apply to Filtered Rows</button>
            </div>
        </section>

        <!-- Data Table -->
        <section id="table-wrap" class="card table-container">
            <div class="table-header">
                <h3>Inspection Data</h3>
                <div class="table-actions">
                    <button id="clearFiltersBtn" class="btn btn-sm">Clear Filters</button>
                </div>
            </div>
            <div class="table-scroll">
                <table id="dataTable">
                    <thead id="tableHead"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </section>

        <!-- Charts Section -->
        <section class="charts-section">
            <div class="card chart-card">
                <h3>Overall Progress</h3>
                <div class="chart-container">
                    <canvas id="progressChart"></canvas>
                </div>
            </div>

            <div class="card chart-card">
                <h3>Boxes by Container</h3>
                <div class="chart-container">
                    <canvas id="boxesByContainerChart"></canvas>
                </div>
            </div>

            <div class="card chart-card full-width">
                <h3>Daily Completion Progress</h3>
                <div class="chart-container">
                    <canvas id="dailyProgressChart"></canvas>
                </div>
            </div>
        </section>
    </main>

    <!-- Audit Log Modal -->
    <div id="auditModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Audit Log</h2>
                <button class="modal-close" id="closeAuditModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="audit-filters">
                    <input type="date" id="auditDateFrom" placeholder="From Date">
                    <input type="date" id="auditDateTo" placeholder="To Date">
                    <select id="auditUserFilter">
                        <option value="all">All Users</option>
                    </select>
                    <button id="filterAuditBtn" class="btn btn-sm">Filter</button>
                </div>
                <div id="auditLogContent" class="audit-log-content">
                    <p class="loading-text">Loading audit logs...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal (Admin Only) -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Admin Panel - User Management</h2>
                <button class="modal-close" id="closeAdminModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="pendingUsers" class="pending-users"></div>
            </div>
        </div>
    </div>

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="assets/scripts/app.js"></script>
</body>

</html>